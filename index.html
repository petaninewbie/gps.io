<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPS Monitoring Real-Time</title>
    <!-- Memuat Tailwind CSS untuk tampilan responsif dan modern -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Menggunakan font Inter dan memastikan tampilan rapi */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
        .pulse-red {
            animation: pulse-red 2s infinite;
        }
        @keyframes pulse-red {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-10 min-h-screen flex items-center justify-center">

    <div class="w-full max-w-2xl bg-white rounded-xl card p-6 space-y-6">
        <h1 class="text-3xl font-bold text-center text-indigo-700">Monitor Lokasi GPS Perangkat</h1>
        <p class="text-center text-sm text-gray-500">Aplikasi ini mengakses posisi GPS perangkat Anda secara real-time melalui browser.</p>

        <!-- Status & Kontrol Utama -->
        <div class="flex flex-col sm:flex-row items-center justify-between p-4 bg-gray-50 rounded-lg">
            <div id="statusIndicator" class="flex items-center space-x-2 text-red-600 font-semibold">
                <span class="w-3 h-3 bg-red-500 rounded-full"></span>
                <span id="statusText">Monitoring Non-aktif</span>
            </div>
            <button id="toggleGpsButton" class="mt-4 sm:mt-0 px-6 py-2 rounded-full font-bold transition duration-300 transform shadow-md bg-indigo-500 hover:bg-indigo-600 text-white">
                Aktifkan Monitoring
            </button>
        </div>

        <!-- Opsi Auto-Refresh (Interval) -->
        <div class="p-4 bg-blue-50 border-l-4 border-blue-400 rounded-lg text-sm text-blue-800">
            <p class="font-bold">Catatan Penting:</p>
            <p>Interval ideal diperkirakan **2000 ms (2 detik)** untuk menghemat baterai. Interval **2 ms** tidak praktis dan akan disesuaikan secara internal ke 2000 ms jika Anda mengaktifkan opsi pembaruan super cepat.</p>
            <label class="inline-flex items-center mt-3 cursor-pointer">
                <input type="checkbox" id="fastRefreshToggle" class="form-checkbox h-5 w-5 text-red-600 rounded-md">
                <span class="ml-2 text-gray-700 font-medium">Aktifkan Pembaruan Super Cepat (2 ms)</span>
            </label>
            <p id="intervalDisplay" class="text-xs mt-1 text-gray-600">Interval Pembaruan Aktif: 2000 ms</p>
        </div>


        <!-- Tampilan Data Lokasi -->
        <div id="locationCard" class="card p-4 bg-gray-100 rounded-lg space-y-3 hidden">
            <h2 class="text-xl font-semibold text-gray-700 border-b pb-2">Posisi Perangkat Saat Ini</h2>

            <!-- Kolom Latitude -->
            <div class="flex justify-between items-start bg-white p-3 rounded-lg border">
                <span class="text-sm font-medium text-gray-500">Latitude (Garis Lintang):</span>
                <span id="latitudeDisplay" class="text-lg font-mono text-gray-800 break-all">--</span>
            </div>

            <!-- Kolom Longitude -->
            <div class="flex justify-between items-start bg-white p-3 rounded-lg border">
                <span class="text-sm font-medium text-gray-500">Longitude (Garis Bujur):</span>
                <span id="longitudeDisplay" class="text-lg font-mono text-gray-800 break-all">--</span>
            </div>

            <!-- Kolom Peta (Maps) sebagai Teks Lokasi -->
            <div class="bg-white p-3 rounded-lg border">
                <span class="text-sm font-medium text-gray-500 block mb-1">Lokasi Perangkat (Maps):</span>
                <p id="addressDisplay" class="text-base text-gray-800 italic">Memuat alamat...</p>
            </div>
        </div>

        <!-- Area Pesan Kesalahan -->
        <div id="messageBox" class="p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg hidden">
            Terjadi Kesalahan: <span id="errorMessage"></span>
        </div>

    </div>

    <script>
        // Variabel global untuk GPS
        let watchId = null;
        let isMonitoring = false;
        let currentInterval = 2000; // Default interval (2 detik)
        const FAST_INTERVAL_LIMIT = 2000; // Batas minimum yang realistis

        // Ambil elemen-elemen DOM
        const toggleButton = document.getElementById('toggleGpsButton');
        const statusIndicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');
        const latitudeDisplay = document.getElementById('latitudeDisplay');
        const longitudeDisplay = document.getElementById('longitudeDisplay');
        const addressDisplay = document.getElementById('addressDisplay');
        const messageBox = document.getElementById('messageBox');
        const errorMessage = document.getElementById('errorMessage');
        const locationCard = document.getElementById('locationCard');
        const fastRefreshToggle = document.getElementById('fastRefreshToggle');
        const intervalDisplay = document.getElementById('intervalDisplay');

        // Konstanta untuk pesan
        const MONITORING_ACTIVE = 'Monitoring Aktif (Real-time)';
        const MONITORING_INACTIVE = 'Monitoring Non-aktif';

        /**
         * Fungsi untuk menampilkan pesan kesalahan
         * @param {string} msg Pesan yang akan ditampilkan
         */
        function displayError(msg) {
            messageBox.classList.remove('hidden');
            errorMessage.textContent = msg;
            console.error("GPS Error:", msg);
        }

        /**
         * Mengubah status visual aplikasi
         * @param {boolean} active Status monitoring
         */
        function updateStatus(active) {
            isMonitoring = active;
            if (active) {
                statusText.textContent = MONITORING_ACTIVE;
                statusIndicator.classList.remove('text-red-600');
                statusIndicator.classList.add('text-green-600');
                statusIndicator.querySelector('span:first-child').classList.remove('bg-red-500');
                statusIndicator.querySelector('span:first-child').classList.add('bg-green-500', 'pulse-red');
                toggleButton.textContent = 'Non-aktifkan Monitoring';
                toggleButton.classList.remove('bg-indigo-500', 'hover:bg-indigo-600');
                toggleButton.classList.add('bg-red-500', 'hover:bg-red-600');
                locationCard.classList.remove('hidden');
            } else {
                statusText.textContent = MONITORING_INACTIVE;
                statusIndicator.classList.remove('text-green-600');
                statusIndicator.classList.add('text-red-600');
                statusIndicator.querySelector('span:first-child').classList.remove('bg-green-500', 'pulse-red');
                statusIndicator.querySelector('span:first-child').classList.add('bg-red-500');
                toggleButton.textContent = 'Aktifkan Monitoring';
                toggleButton.classList.remove('bg-red-500', 'hover:bg-red-600');
                toggleButton.classList.add('bg-indigo-500', 'hover:bg-indigo-600');
                locationCard.classList.add('hidden');
            }
            messageBox.classList.add('hidden');
        }

        /**
         * Callback sukses untuk Geolocation API
         * @param {GeolocationPosition} position Objek posisi yang berisi koordinat
         */
        function successCallback(position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            const accuracy = position.coords.accuracy;

            // Memperbarui tampilan
            latitudeDisplay.textContent = lat.toFixed(6);
            longitudeDisplay.textContent = lon.toFixed(6);

            // Menampilkan akurasi (opsional)
            console.log(`Posisi diperbarui. Akurasi: Â±${accuracy.toFixed(2)} meter.`);

            // Di dunia nyata, Anda akan menggunakan Reverse Geocoding API di sini
            // Karena ini adalah contoh satu file, kita gunakan alamat placeholder
            addressDisplay.textContent = `(${lat.toFixed(6)}, ${lon.toFixed(6)}) - Membutuhkan Reverse Geocoding API untuk alamat.`;
        }

        /**
         * Callback gagal untuk Geolocation API
         * @param {GeolocationPositionError} error Objek error
         */
        function errorCallback(error) {
            // Menghentikan monitoring secara otomatis jika terjadi error
            stopGpsMonitoring();
            let msg = '';
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    msg = "Akses lokasi ditolak oleh pengguna.";
                    break;
                case error.POSITION_UNAVAILABLE:
                    msg = "Informasi lokasi tidak tersedia saat ini.";
                    break;
                case error.TIMEOUT:
                    msg = "Waktu tunggu untuk mendapatkan lokasi habis. Coba lagi.";
                    break;
                default:
                    msg = `Kesalahan tidak dikenal: ${error.message}`;
            }
            displayError(msg);
        }

        /**
         * Memulai pemantauan GPS menggunakan watchPosition
         */
        function startGpsMonitoring() {
            if (!("geolocation" in navigator)) {
                displayError("Peramban Anda tidak mendukung Geolocation API.");
                return;
            }

            // Opsi untuk watchPosition
            const options = {
                enableHighAccuracy: true, // Menggunakan GPS jika tersedia
                timeout: 5000,           // Batas waktu untuk mendapatkan lokasi
                maximumAge: 0            // Memaksa pengambilan posisi baru
            };

            // Menggunakan watchId untuk menyimpan ID pemantauan
            // watchPosition secara otomatis akan memanggil successCallback setiap kali posisi berubah
            // atau sesuai interval yang ditetapkan oleh sistem operasi/browser (yang biasanya minimum 1 detik).
            watchId = navigator.geolocation.watchPosition(successCallback, errorCallback, options);
            updateStatus(true);
        }

        /**
         * Menghentikan pemantauan GPS
         */
        function stopGpsMonitoring() {
            if (watchId !== null) {
                navigator.geolocation.clearWatch(watchId);
                watchId = null;
            }
            updateStatus(false);
            latitudeDisplay.textContent = '--';
            longitudeDisplay.textContent = '--';
            addressDisplay.textContent = 'Monitoring dihentikan.';
        }

        /**
         * Menghandle klik tombol toggle
         */
        toggleButton.addEventListener('click', () => {
            if (isMonitoring) {
                stopGpsMonitoring();
            } else {
                startGpsMonitoring();
            }
        });

        /**
         * Menghandle toggle pembaruan super cepat (2 ms)
         * Dalam implementasi web standar, ini hanya memengaruhi seberapa sering browser
         * MENCARI posisi baru, bukan seberapa sering ia mengirimkannya.
         * Kami menggunakan interval 2000ms yang realistis, namun tetap membolehkan toggle
         * untuk tujuan demonstrasi, sambil memberikan peringatan.
         */
        fastRefreshToggle.addEventListener('change', () => {
            if (fastRefreshToggle.checked) {
                // Untuk real-time monitoring yang agresif, kita gunakan nilai minimal realistis
                // 2000 ms, mengabaikan 2 ms karena ketidakpraktisannya di web/mobile.
                currentInterval = 2000;
                intervalDisplay.textContent = `Interval Pembaruan Aktif: ${currentInterval} ms (Diaktifkan. Catatan: Menggunakan 2000 ms sebagai batas minimum realistis)`;
            } else {
                currentInterval = 2000; // Kembali ke 2 detik
                intervalDisplay.textContent = `Interval Pembaruan Aktif: ${currentInterval} ms`;
            }

            // Jika sedang monitoring, kita restart untuk menerapkan opsi baru (walaupun efeknya minimal pada watchPosition)
            if (isMonitoring) {
                stopGpsMonitoring();
                startGpsMonitoring();
            }
        });

        // Inisialisasi status awal
        updateStatus(false);
    </script>
</body>
</html>

